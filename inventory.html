<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Klasik Plus ERP</title>
  <style>
    .low-stock {
      background-color: #f8d7da; /* light red */
    }
  </style>
</head>
<body>

  <h1>Inventory</h1>

  <nav>
    <ul>
      <li><a href="purchasing.html">Purchasing</a></li>
      <li><a href="inventory.html">Inventory</a></li>
      <li><a href="accounting.html">Accounting</a></li>
    </ul>
  </nav>

  <form id="inventoryForm">
    <div>
      <label>ID: <input type="number" id="itemId" placeholder="ID"></label>
    </div>
    <div>
      <label>Product Name: <input type="text" id="itemName" placeholder="Product Name"></label>
    </div>
    <div>
      <label>Category: <input type="text" id="itemCategory" placeholder="Category"></label>
    </div>
    <div>
      <label>Quantity: <input type="number" id="itemQuantity" placeholder="Quantity"></label>
    </div>
    <div>
      <label>Price ($): <input type="number" id="itemPrice" placeholder="Price ($)"></label>
    </div>
    <div>
      <label>Location: <input type="text" id="itemLocation" placeholder="Location"></label>
    </div>
    <div>
      <label>Threshold: <input type="number" id="itemThreshold" placeholder="Threshold"></label>
    </div>
    <button type="button" onclick="addItem()">Add</button>
  </form>

  <div>
    <label>Filter by Location: 
      <input type="text" id="locationFilter" placeholder="Enter location" oninput="renderInventory()" />
    </label>
  </div>

  <table id="inventoryTable">
    <thead>
      <tr>
        <th>ID</th>
        <th>Product Name</th>
        <th>Category</th>
        <th>Quantity</th>
        <th>Price ($)</th>
        <th>Location</th>
        <th>Threshold</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    // Fetch inventory from local storage or initialize empty
    let inventory = JSON.parse(localStorage.getItem('inventory')) || [];

    const tableBody = document.querySelector("#inventoryTable tbody");

    function saveInventory() {
      localStorage.setItem('inventory', JSON.stringify(inventory));
    }

    function renderInventory() {
      const filterValue = document.getElementById("locationFilter").value.trim().toLowerCase();
      tableBody.innerHTML = "";

      inventory
        .filter(item => !filterValue || item.location.toLowerCase().includes(filterValue))
        .forEach(item => {
          const row = document.createElement("tr");
          if (item.quantity < item.threshold) row.classList.add("low-stock");

          const keys = ["id", "name", "category", "quantity", "price", "location", "threshold"];
          keys.forEach(key => {
            const cell = document.createElement("td");
            cell.textContent = item[key];
            if (key !== "id") {
              cell.addEventListener("dblclick", () => makeCellEditable(cell, item, key));
            }
            row.appendChild(cell);
          });

          const actions = document.createElement("td");
          const removeBtn = document.createElement("button");
          removeBtn.textContent = "Remove";
          removeBtn.onclick = () => removeItem(item.id);
          actions.appendChild(removeBtn);
          row.appendChild(actions);

          tableBody.appendChild(row);
        });
    }

    function makeCellEditable(cell, item, key) {
      const originalValue = cell.textContent;
      cell.innerHTML = `<input type="text" value="${originalValue}" />`;
      const input = cell.querySelector("input");
      input.focus();

      input.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          let newValue = input.value;
          if (["quantity", "price", "threshold"].includes(key)) {
            newValue = parseFloat(newValue);
            if (isNaN(newValue)) {
              alert("Invalid number");
              input.focus();
              return;
            }
          }
          item[key] = newValue;
          saveInventory();
          renderInventory();
        } else if (e.key === "Escape") {
          cell.textContent = originalValue;
        }
      });

      input.addEventListener("blur", () => {
        cell.textContent = originalValue;
      });
    }

    function removeItem(id) {
      const index = inventory.findIndex(i => i.id === id);
      if (index === -1) return;
      inventory.splice(index, 1);
      saveInventory();
      renderInventory();
    }

    function getFormData() {
      return {
        id: parseInt(document.getElementById("itemId").value),
        name: document.getElementById("itemName").value,
        category: document.getElementById("itemCategory").value,
        quantity: parseFloat(document.getElementById("itemQuantity").value),
        price: parseFloat(document.getElementById("itemPrice").value),
        location: document.getElementById("itemLocation").value,
        threshold: parseFloat(document.getElementById("itemThreshold").value)
      };
    }

    function addItem() {
      const newItem = getFormData();
      if (!newItem.id || !newItem.name) {
        alert("Please provide at least an ID and a name.");
        return;
      }
      if (inventory.some(item => item.id === newItem.id)) {
        alert("ID already exists.");
        return;
      }
      inventory.push(newItem);
      saveInventory();
      renderInventory();
      document.getElementById("inventoryForm").reset();
    }

    renderInventory();
  </script>

</body>
</html>
